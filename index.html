<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>借钱投资盈亏平衡计算器</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            background: white;
            border: 3px solid #0075be;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(0, 117, 190, 0.4);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: white;
            border: 3px solid #0075be;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        
        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(0, 117, 190, 0.4);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Icon components
        const Calculator = ({ className, style }) => (
            <svg className={className} style={style} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
            </svg>
        );

        const Percent = ({ className, style }) => (
            <svg className={className} style={style} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7L5 11m0 0l4 4M5 11h14m0 0l-4-4m4 4l-4 4" />
                <circle cx="7" cy="7" r="1.5" fill="currentColor" />
                <circle cx="17" cy="17" r="1.5" fill="currentColor" />
            </svg>
        );

        const DollarSign = ({ className, style }) => (
            <svg className={className} style={style} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const TrendingUp = ({ className, style }) => (
            <svg className={className} style={style} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
        );

        function InvestmentCalculator() {
            const [interestRate, setInterestRate] = useState(5);
            const [annualIncome, setAnnualIncome] = useState(200000);
            
            // 计算边际税率 - 2025年安大略省多伦多市税率（含附加税）
            const calculateMarginalTaxRate = (income) => {
                // 联邦税率 (2025)
                let federalRate = 0;
                if (income <= 55867) {
                    federalRate = 15;
                } else if (income <= 111733) {
                    federalRate = 20.5;
                } else if (income <= 173205) {
                    federalRate = 26;
                } else if (income <= 246752) {
                    federalRate = 29;
                } else {
                    federalRate = 33;
                }
                
                // 安大略省基本税率 (2025)
                let baseProvincialRate = 0;
                if (income <= 51446) {
                    baseProvincialRate = 5.05;
                } else if (income <= 102894) {
                    baseProvincialRate = 9.15;
                } else if (income <= 150000) {
                    baseProvincialRate = 11.16;
                } else if (income <= 220000) {
                    baseProvincialRate = 12.16;
                } else {
                    baseProvincialRate = 13.16;
                }
                
                // 安大略省附加税 (Surtax)
                // 20%附加税适用于省税超过$5,315 (约$72,000收入)
                // 额外36%附加税适用于省税超过$6,839 (约$91,000收入)
                // 对于高收入者，总附加税为56% (20% + 36%)
                let effectiveProvincialRate = baseProvincialRate;
                
                if (income > 91000) {
                    // 高收入：基本税率 × 1.56 (包含56%附加税)
                    effectiveProvincialRate = baseProvincialRate * 1.56;
                } else if (income > 72000) {
                    // 中高收入：基本税率 × 1.20 (包含20%附加税)
                    effectiveProvincialRate = baseProvincialRate * 1.20;
                }
                
                return federalRate + effectiveProvincialRate;
            };
            
            const marginalTaxRate = calculateMarginalTaxRate(annualIncome);
            const capitalGainsTaxRate = marginalTaxRate / 2;
            
            // 计算
            const afterTaxCost = interestRate * (1 - marginalTaxRate / 100);
            const afterTaxRetention = 1 - capitalGainsTaxRate / 100;
            const breakEvenReturn = afterTaxCost / afterTaxRetention;
            
            const getFederalRate = () => {
                if (annualIncome <= 55867) return '15.00';
                if (annualIncome <= 111733) return '20.50';
                if (annualIncome <= 173205) return '26.00';
                if (annualIncome <= 246752) return '29.00';
                return '33.00';
            };

            const getFederalBracket = () => {
                if (annualIncome <= 55867) return '收入档次: $0 - $55,867';
                if (annualIncome <= 111733) return '收入档次: $55,868 - $111,733';
                if (annualIncome <= 173205) return '收入档次: $111,734 - $173,205';
                if (annualIncome <= 246752) return '收入档次: $173,206 - $246,752';
                return '收入档次: $246,753+';
            };

            const getProvincialRate = () => {
                let baseRate = 0;
                if (annualIncome <= 51446) baseRate = 5.05;
                else if (annualIncome <= 102894) baseRate = 9.15;
                else if (annualIncome <= 150000) baseRate = 11.16;
                else if (annualIncome <= 220000) baseRate = 12.16;
                else baseRate = 13.16;
                
                // 应用附加税
                if (annualIncome > 91000) {
                    return (baseRate * 1.56).toFixed(2);
                } else if (annualIncome > 72000) {
                    return (baseRate * 1.20).toFixed(2);
                }
                return baseRate.toFixed(2);
            };

            const getProvincialBracket = () => {
                if (annualIncome <= 51446) return '收入档次: $0 - $51,446';
                if (annualIncome <= 102894) return '收入档次: $51,447 - $102,894';
                if (annualIncome <= 150000) return '收入档次: $102,895 - $150,000';
                if (annualIncome <= 220000) return '收入档次: $150,001 - $220,000';
                return '收入档次: $220,001+';
            };
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-sky-50 to-cyan-50 p-8">
                    <div className="max-w-4xl mx-auto">
                        {/* 标题 */}
                        <div className="text-center mb-12">
                            <div className="flex items-center justify-center gap-3 mb-4">
                                <Calculator className="w-10 h-10" style={{ color: '#0075be' }} />
                                <h1 className="text-4xl font-bold text-gray-800">借钱投资盈亏平衡计算器</h1>
                            </div>
                            <p className="text-gray-600 text-lg">调整借款利率，看看你需要赚多少才不亏</p>
                        </div>

                        {/* 主卡片 */}
                        <div className="bg-white rounded-3xl shadow-2xl p-8 mb-8">
                            {/* 滑块区域 - 左右排列 */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                {/* 利率滑块 */}
                                <div>
                                    <div className="flex items-center justify-between mb-4">
                                        <label className="text-lg font-semibold text-gray-700 flex items-center gap-2">
                                            <Percent className="w-5 h-5" style={{ color: '#0075be' }} />
                                            借款利率
                                        </label>
                                        <span className="text-3xl font-bold" style={{ color: '#0075be' }}>{interestRate.toFixed(1)}%</span>
                                    </div>
                                    <input
                                        type="range"
                                        min="0"
                                        max="15"
                                        step="0.1"
                                        value={interestRate}
                                        onChange={(e) => setInterestRate(parseFloat(e.target.value))}
                                        className="w-full h-3 bg-blue-100 rounded-lg appearance-none cursor-pointer slider"
                                        style={{
                                            background: `linear-gradient(to right, #0075be 0%, #0075be ${(interestRate / 15) * 100}%, #dbeafe ${(interestRate / 15) * 100}%, #dbeafe 100%)`
                                        }}
                                    />
                                    <div className="flex justify-between text-sm text-gray-500 mt-2">
                                        <span>0%</span>
                                        <span>15%</span>
                                    </div>
                                </div>

                                {/* 年收入滑块 */}
                                <div>
                                    <div className="flex items-center justify-between mb-4">
                                        <label className="text-lg font-semibold text-gray-700 flex items-center gap-2">
                                            <DollarSign className="w-5 h-5" style={{ color: '#0075be' }} />
                                            T4年收入
                                        </label>
                                        <span className="text-3xl font-bold" style={{ color: '#0075be' }}>
                                            ${(annualIncome / 1000).toFixed(0)}K
                                        </span>
                                    </div>
                                    <input
                                        type="range"
                                        min="0"
                                        max="1000000"
                                        step="10000"
                                        value={annualIncome}
                                        onChange={(e) => setAnnualIncome(parseFloat(e.target.value))}
                                        className="w-full h-3 bg-blue-100 rounded-lg appearance-none cursor-pointer slider"
                                        style={{
                                            background: `linear-gradient(to right, #0075be 0%, #0075be ${(annualIncome / 1000000) * 100}%, #dbeafe ${(annualIncome / 1000000) * 100}%, #dbeafe 100%)`
                                        }}
                                    />
                                    <div className="flex justify-between text-sm text-gray-500 mt-2">
                                        <span>$0</span>
                                        <span>$1M</span>
                                    </div>
                                </div>
                            </div>
                            
                            {/* 税率详细展示 - 左右排列 */}
                            <div className="mb-8">
                                {/* 联邦和省税率 */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    {/* 联邦税率 */}
                                    <div className="bg-gradient-to-r from-red-50 to-red-100 rounded-lg p-4 border-l-4 border-red-500">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-sm font-semibold text-gray-700">🇨🇦 联邦税率</span>
                                            <span className="text-lg font-bold text-red-700">
                                                {getFederalRate()}%
                                            </span>
                                        </div>
                                        <div className="text-xs text-gray-600">
                                            {getFederalBracket()}
                                        </div>
                                    </div>

                                    {/* 省税率 */}
                                    <div className="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border-l-4" style={{ borderLeftColor: '#0075be' }}>
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-sm font-semibold text-gray-700">🏛️ 安大略省税率</span>
                                            <span className="text-lg font-bold" style={{ color: '#0075be' }}>
                                                {getProvincialRate()}%
                                            </span>
                                        </div>
                                        <div className="text-xs text-gray-600">
                                            {getProvincialBracket()}
                                            {annualIncome > 91000 && <div className="mt-1 text-red-600">含56%附加税 (20%+36%)</div>}
                                            {annualIncome > 72000 && annualIncome <= 91000 && <div className="mt-1 text-orange-600">含20%附加税</div>}
                                        </div>
                                    </div>
                                </div>

                                {/* 边际税率和资本利得税率 */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {/* 边际税率总计 */}
                                    <div className="bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border-l-4 border-purple-600">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-sm font-semibold text-gray-700">📊 边际税率</span>
                                            <span className="text-2xl font-bold text-purple-700">
                                                {marginalTaxRate.toFixed(2)}%
                                            </span>
                                        </div>
                                        <div className="text-xs text-gray-600">
                                            联邦+省，每多赚$1需缴${(marginalTaxRate / 100).toFixed(2)}税
                                        </div>
                                    </div>

                                    {/* 资本利得税率 */}
                                    <div className="bg-gradient-to-r from-green-50 to-emerald-100 rounded-lg p-4 border-l-4 border-green-600">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-sm font-semibold text-gray-700">💰 资本利得税率</span>
                                            <span className="text-2xl font-bold text-green-700">
                                                {capitalGainsTaxRate.toFixed(2)}%
                                            </span>
                                        </div>
                                        <div className="text-xs text-gray-600">
                                            {marginalTaxRate.toFixed(2)}% × 50% (仅50%计入应税)
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* 结果展示 */}
                            <div className="rounded-2xl p-8 text-white mb-8" style={{ background: 'linear-gradient(135deg, #0075be 0%, #005587 100%)' }}>
                                <div className="text-center mb-6">
                                    <div className="flex items-center justify-center gap-2 mb-2">
                                        <TrendingUp className="w-6 h-6" />
                                        <h2 className="text-2xl font-bold">盈亏平衡点</h2>
                                    </div>
                                    <p className="opacity-90">你的投资至少需要达到</p>
                                </div>
                                <div className="text-center">
                                    <div className="text-6xl font-bold mb-2">
                                        {breakEvenReturn.toFixed(2)}%
                                    </div>
                                    <p className="text-lg opacity-90">税前投资回报率</p>
                                </div>
                            </div>

                            {/* 计算步骤 - 左右排列 */}
                            <div className="space-y-6">
                                <h3 className="text-xl font-bold text-gray-800 mb-4">计算过程</h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* 步骤1 */}
                                    <div className="bg-blue-50 rounded-xl p-6 border-l-4" style={{ borderLeftColor: '#0075be' }}>
                                        <div className="flex items-start gap-3">
                                            <div className="text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0 mt-1" style={{ backgroundColor: '#0075be' }}>1</div>
                                            <div className="flex-1">
                                                <h4 className="font-semibold text-gray-800 mb-2">借款的真实成本</h4>
                                                <p className="text-gray-600 mb-3 text-sm">因为利息可以抵税,政府帮你承担了一部分成本</p>
                                                <div className="bg-white rounded-lg p-4">
                                                    <div className="font-mono text-xs space-y-1">
                                                        <div className="text-gray-600">实际成本 = {interestRate.toFixed(1)}% × (1 - {marginalTaxRate.toFixed(2)}%)</div>
                                                        <div className="text-gray-600">实际成本 = {interestRate.toFixed(1)}% × {(100 - marginalTaxRate).toFixed(2)}%</div>
                                                        <div className="text-base font-bold" style={{ color: '#0075be' }}>= {afterTaxCost.toFixed(3)}%</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* 步骤2 */}
                                    <div className="rounded-xl p-6 border-l-4" style={{ backgroundColor: '#e0f2fe', borderLeftColor: '#0284c7' }}>
                                        <div className="flex items-start gap-3">
                                            <div className="text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0 mt-1" style={{ backgroundColor: '#0284c7' }}>2</div>
                                            <div className="flex-1">
                                                <h4 className="font-semibold text-gray-800 mb-2">需要的投资回报</h4>
                                                <p className="text-gray-600 mb-3 text-sm">投资收益只交半价税,但你只能留下 {(afterTaxRetention * 100).toFixed(2)}% 的收益</p>
                                                <div className="bg-white rounded-lg p-4">
                                                    <div className="font-mono text-xs space-y-1">
                                                        <div className="text-gray-600">资本利得税率 = {marginalTaxRate.toFixed(2)}% ÷ 2 = {capitalGainsTaxRate.toFixed(2)}%</div>
                                                        <div className="text-gray-600">税后留存 = 1 - {capitalGainsTaxRate.toFixed(2)}% = {(afterTaxRetention * 100).toFixed(2)}%</div>
                                                        <div className="text-gray-600">税前收益 = {afterTaxCost.toFixed(3)}% ÷ {(afterTaxRetention * 100).toFixed(2)}%</div>
                                                        <div className="text-base font-bold" style={{ color: '#0284c7' }}>= {breakEvenReturn.toFixed(3)}%</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* 结论卡片 */}
                        <div className="bg-white rounded-2xl shadow-lg p-6">
                            <div className="flex items-start gap-4">
                                <DollarSign className="w-8 h-8 text-green-600 flex-shrink-0" />
                                <div>
                                    <h3 className="text-xl font-bold text-gray-800 mb-3">一句话总结</h3>
                                    <p className="text-gray-700 text-lg leading-relaxed">
                                        年收入 ${(annualIncome / 1000).toFixed(0)}K，边际税率 {marginalTaxRate.toFixed(1)}%，{interestRate.toFixed(1)}% 的借款成本需要{' '}
                                        <span className="font-bold" style={{ color: '#0075be' }}>{breakEvenReturn.toFixed(2)}%</span>{' '}
                                        的投资回报才能打平。
                                        {breakEvenReturn < 3 && <span className="text-green-600"> 这个门槛相对较低！</span>}
                                        {breakEvenReturn >= 3 && breakEvenReturn < 6 && <span style={{ color: '#d97706' }}> 需要稳健的投资策略。</span>}
                                        {breakEvenReturn >= 6 && <span className="text-red-600"> 这是个不小的挑战！</span>}
                                    </p>
                                </div>
                            </div>
                        </div>

                        {/* 页脚 */}
                        <div className="text-center mt-8 text-gray-500 text-sm">
                            <p>基于安大略省多伦多市2025年税率（含附加税），资本利得50%计入应税收入</p>
                            <p className="mt-1">联邦税率 + 省税率（含附加税）= 边际税率（最高53.53%）</p>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<InvestmentCalculator />);
    </script>
</body>
</html>
